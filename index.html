<html>
<head>
	<title>Assignment 6 - Jonathan Lee - jwl274 </title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<link href="https://fonts.googleapis.com/css?family=Lato&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><style>
	body {font-family:"Lato";}

	.circles_text_table { font-size: 10px; fill:white;}

	.points_bar_table { fill:#e0e0e0;}
	.points_text_table {font-size:10px; text-anchor:middle;}
	.club_text_table {font-size:10px;}
	.bar_table {fill:none;}

	.win{fill:green;}
	.draw{fill:#e0e0e0;}
	.loss{fill:red;}

	.win_text{font-size:10px;fill:white;}
	.draw_text{font-size:10px;fill:black}
	.loss_text{font-size:10px;fill:white;}

	.season { cursor:pointer;}
	.arrow_table_up {fill:green;}
	.arrow_table_down {fill:red;}
	.arrow_table_netural {fill:lightGray;}

	#seasons {
		display: flex; 
		flex-wrap: nowrap; 
		justify-content: space-around; 
		align-items: center;
		margin:0 auto;
		list-style: none;
		width:70%;
		height:50px;
	}

	.point_line { stroke:rgb(255,0,0);stroke-width:2;}


</style>

</head>

<body>
<h1>The Premier League at a Glance</h1>
<div id="seasonYears">
<ul id="seasons">
	<li id="season_11_12" class="season">11-12</li>
	<li id="season_12_13" class="season">12-13</li>
	<li id="season_13_14" class="season">13-14</li>
	<li id="season_14_15" class="season">14-15</li>
	<li id="season_15_16" class="season">15-16</li>

</div>
<div id="table"></div>

<script>
var height_table = 600;
var width_table = 1000;
var padding_table = 30;

var svg_table = d3.select("#table").append("svg").attr("height", height_table).attr("width", width_table);
var table; 
var circles_table,circles_text_table;
var club_images_table, club_text_table;
var points_bar_table,points_text_table,bar_table;
var win_bar_table,draw_bar_table,loss_bar_table;
var xScale_table = d3.scale.linear().domain([0,102]).range([padding_table+190,width_table]);
var season_10_11,season_12_13,season_11_12,season_13_14,season_14_15,season_15_16;
var current_season = "season_15_16";
var points_bars; 
var yScale_table;
var last_season; 
var arrow_table; 

d3.json("epl-10-11.json", function (error, data) {season_10_11 = data; });
d3.json("epl-11-12.json", function (error, data) {season_11_12 = data; });
d3.json("epl-12-13.json", function (error, data) {season_12_13 = data; });
d3.json("epl-13-14.json", function (error, data) {season_13_14 = data; });
d3.json("epl-14-15.json", function (error, data) {season_14_15 = data; last_season = season_14_15;
});

d3.json("epl-15-16.json", function (error, data) {
	var ul = document.getElementById("seasons");
	ul.addEventListener('click',function(e) { 
		current_season = e.target.id; 
		if (e.target.id ==='season_14_15') { last_season = season_13_14; update_season(season_14_15);}
		else if (e.target.id =='season_15_16') {last_season = season_14_15; update_season(season_15_16);}
		else if (e.target.id =='season_13_14') {last_season = season_12_13; update_season(season_13_14);}
		else if (e.target.id =='season_12_13') {last_season = season_11_12; update_season(season_12_13);}
		else if (e.target.id =='season_11_12') {last_season = season_10_11; update_season(season_11_12);}

	});

	season_15_16 = data; 

	yScale_table = d3.scale.ordinal().domain([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]).rangeBands([padding_table,height_table-padding_table]);

	svg_table.append("line")
		.attr("x1",xScale_table(102) )
		.attr("x2",xScale_table(102) )
		.attr("y1",0)
		.attr("y2",height_table - padding_table)
		.attr("class","point_line");

	//Add Circles and Rank Labeling
	circles_table = svg_table.selectAll(".circles_table").data(season_15_16);
	circles_table.enter().append("circle")
		.attr("class","circles_table")
		.attr("r",10)
		.attr("fill","#2166ac")
		.attr("cx",padding_table)
		.attr("cy",function(d) {
			return yScale_table(d.rank);
		})

	circles_text_table = svg_table.selectAll(".circles_text_table").data(season_15_16);
	circles_text_table.enter().append("text")
		.attr("class","circles_text_table")
		.attr("text-anchor","middle")
		.attr("dx",padding_table)
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.attr("dy",".3em")
		.text(function(d) {return d.rank;});
			
	//Add Club Images and Text
	club_images_table = svg_table.selectAll(".club_images_table").data(season_15_16);
	club_images_table.enter().append("svg:image")
		.attr("class","club_images_table")
    	.attr("xlink:href", function(d) {
    		var club_name = d.team.replace(/\s/g, '');
    		return "images/"  + club_name + ".png"; })
		.attr("x",padding_table+145)
		.attr("y",function(d) { return yScale_table(d.rank)-15;})
		.attr("width",20)
		.attr("height",20);

	club_text_table = svg_table.selectAll(".club_text_table").data(season_15_16);
	club_text_table.enter().append("text")
		.attr("class","club_text_table")
		.attr("x",padding_table+20)
		.attr("dy",".3em")
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.text(function(d) {return d.team;});

	//Add Win, Draw, and Loss Bar
	win_bar_table = svg_table.selectAll(".win_bar_table").data(season_15_16);
	win_bar_table.enter().append("rect")
		.attr("class",function(d,i) {return "wins_" + i + " win";})
		.attr("pointer-events","none")
		.attr("x",xScale_table(0))
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	draw_bar_table = svg_table.selectAll(".draw_bar_table").data(season_15_16);
	draw_bar_table.enter().append("rect")
		.attr("class",function(d,i) {return "draws_" + i  + " draw";})
		.attr("pointer-events","none")
		.attr("x",function(d) { return xScale_table(d.wins*3);})
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	loss_bar_table = svg_table.selectAll(".loss_bar_table").data(season_15_16);
	loss_bar_table.enter().append("rect")
		.attr("class",function(d,i) {return "losses_" + i + " loss";})
		.attr("pointer-events","none")
		.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws) })
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	//Add Invisible Bar for Handling Touch Events
	bar_table = svg_table.selectAll(".bar_table").data(season_15_16);
	bar_table.enter().append("rect")
		.attr("pointer-events","all")
		.attr("class","bar_table")
		.attr("width",function(d) { 	
			return xScale_table(d.points);
		})
		.attr("height","15")
		.attr("x",xScale_table(0))
		.attr("y",function(d) { 	
			return yScale_table(d.rank)-10;
		})
		.on("mouseenter",function(d,i) { 
			d3.select(".points_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".wins_" + i  ).transition().delay(400).attr("width",function() {return xScale_table(d.wins*3) - xScale_table(0);});
			d3.select(".draws_" + i ).transition().delay(450).attr("width",function() {return xScale_table(d.draws) - xScale_table(0);});
			d3.select(".losses_" + i).transition().delay(500).attr("width",function() {return xScale_table(d.losses*3) - xScale_table(0);});
			d3.select(".wins_text_" + i).transition().delay(600).attr("visibility","visible");
			d3.select(".draws_text_" + i ).transition().delay(600).attr("visibility","visible");			
			d3.select(".losses_text_" + i ).transition().delay(600).attr("visibility","visible");
			d3.select(".arrow_table_" + i ).transition().delay(600).attr("visibility","visible");
			d3.selectAll(".points_text_table_" + i ).transition().attr("visibility","hidden");
			
		})
		.on("mouseleave",function(d,i) { 
			d3.select(".wins_" + i).transition().attr("width",function() {return 0;});
			d3.select(".draws_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".losses_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".points_" + i ).transition().delay(500).attr("width",xScale_table(d.points) - xScale_table(0));
			d3.select(".wins_text_" + i ).transition().delay(250).attr("visibility","hidden");
			d3.select(".draws_text_" + i ).transition().delay(250).attr("visibility","hidden");			
			d3.select(".losses_text_" + i ).transition().delay(250).attr("visibility","hidden");	
			d3.select(".arrow_table_" + i ).transition().delay(250).attr("visibility","hidden");					
			d3.selectAll(".points_text_table_" + i ).transition().delay(600).attr("visibility","visible");			
		});

	points_bar_table = svg_table.selectAll(".points_bar_table").data(season_15_16);
	points_bar_table.enter().append("rect")
		.attr("pointer-events","none")
		.attr("class",function(d,i) {return "points_" + i + " points_bar_table";})
		.attr("width",function(d) { 	
			return xScale_table(d.points)-xScale_table(0);
		})
		.attr("height","15")
		.attr("x",function(d) {return xScale_table(0);})
		.attr("y",function(d) { 	
			return yScale_table(d.rank)-10;
		});

	win_text_table = svg_table.selectAll("win_text_table").data(season_15_16);
	win_text_table.enter().append("text")
	.attr("class",function(d,i) {return "wins_text_" + i + " win_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(0)})
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.wins + " wins"; 
	});	

	draw_text_table = svg_table.selectAll("draw_text_table").data(season_15_16);
	draw_text_table.enter().append("text")
	.attr("class",function(d,i) {return "draws_text_" + i + " draw_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(d.wins*3);})
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.draws + " draws"; 
	});	

	loss_text_table = svg_table.selectAll("loss_text_table").data(season_15_16);
	loss_text_table.enter().append("text")
	.attr("class",function(d,i) {return "losses_text_" + i + " loss_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws)})
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.losses + " losses"; 
	});	

	arrow_table = svg_table.selectAll(".arrow_table_up.arrow_table_down.arrow_table_neutral").data(season_15_16);
	arrow_table.enter().append("text")
		.attr("class",function(d,i) {
			var result = lastSeason(d,i);
			if (result[1] == 0) { 
				return "arrow_table_up" + " arrow_table_" +i + " arrow";
			}

			else if (result[1] ==1) { 
				return "arrow_table_down" + " arrow_table_" +i + " arrow";
			}

			else { 
				return "arrow_table_neutral" + " arrow_table_" + i + " arrow";
			}

		})
		.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws + d.losses*3) + 10;})
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.attr("visibility","hidden")
		.text(function(d,i) { 
			var result = lastSeason(d,i);
			return result[0];
		});
});

function lastSeason (d,i) { 
	var current_rank = d.rank;
	var difference;
	for( c =0; c < last_season.length; c++) { 
		if (last_season[c].team == d.team) { 
			difference = last_season[c].rank - d.rank;
		}
	}
	if (difference >0) { 
		return [String.fromCharCode(8593) + " +" + difference,0];

	}
	else if (difference <0) { 
		return [String.fromCharCode(8595) + " " + difference,1];
	}

	else if (difference ==0) { 
		return  [" " + difference,2];

	}

	else { 
		return [String.fromCharCode(8593) + " Promoted",0];
	}

}

function update_season(season) {
	if (season == season_15_16) { 
		xScale_table = d3.scale.linear().domain([0,102]).range([padding_table+190,width_table]);
	}

	else { 
		xScale_table = d3.scale.linear().domain([0,114]).range([padding_table+190,width_table]);
		svg_table.append("line")
			.attr("x1",xScale_table(114) )
			.attr("x2",xScale_table(114) )
			.attr("y1",0)
			.attr("y2",height_table - padding_table)
			.attr("class","point_line");
	}

	svg_table.selectAll(".arrow").data(season)
		.attr("class",function(d,i) {
			var result = lastSeason(d,i);
			if (result[1] == 0) { 
				return "arrow_table_up" + " arrow_table_" +i +" arrow";
			}

			else if (result[1] ==1) { 
				return "arrow_table_down" + " arrow_table_" +i + " arrow";
			}

			else { 
				return "arrow_table_neutral" + " arrow_table_" + i + " arrow";
			}

		})
		.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws + d.losses*3) + 10;})
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.attr("visibility","hidden")
		.text(function(d,i) { 
			console.log(d.team + "  i");
			var result = lastSeason(d,i);
			return result[0];
		});

	svg_table.selectAll(".points_text_table").data(season)
		.attr("class",function(d,i) {return "points_text_table_" + i + " points_text_table";})
		.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws) + 10;})
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.attr("dy",".2em")
		.text(function(d) { return d.points;});

	svg_table.selectAll(".club_images_table").data(season)
		.attr("class","club_images_table")
    	.attr("xlink:href", function(d) {
    		var club_name = d.team.replace(/\s/g, '');
    		return "images/"  + club_name + ".png"; })
		.attr("x",padding_table+145)
		.attr("y",function(d) { return yScale_table(d.rank)-15;})
		.attr("width",20)
		.attr("height",20);

	svg_table.selectAll(".club_text_table").data(season)
		.attr("class","club_text_table")
		.attr("x",padding_table+20)
		.attr("dy",".3em")
		.attr("y",function(d) { 	
			return yScale_table(d.rank);
		})
		.text(function(d) {return d.team;});

	//Add Win, Draw, and Loss Bar
	svg_table.selectAll(".points_bar_table").data(season)
		.transition()
		.attr("pointer-events","none")
		.attr("class",function(d,i) {return "points_" + i + " points_bar_table";})
		.attr("width",function(d) { 	
			return xScale_table(d.points) - xScale_table(0);
		})
		.attr("height","15")
		.attr("x",xScale_table(0))
		.attr("y",function(d) { 	
			return yScale_table(d.rank)-10;
		});

	svg_table.selectAll(".win").data(season)
		.attr("class",function(d,i) {return "wins_" + i + " win";})
		.attr("pointer-events","none")
		.attr("x",padding_table + 190 )
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	svg_table.selectAll(".draw").data(season)
		.attr("class",function(d,i) {return "draws_" + i  + " draw";})
		.attr("pointer-events","none")
		.attr("x",function(d) { return xScale_table(d.wins*3);})
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	svg_table.selectAll(".loss").data(season)
		.attr("class",function(d,i) {return "losses_" + i + " loss";})
		.attr("pointer-events","none")
		.attr("x",function(d) { return xScale_table(d.wins*3 + d.draws)})
		.attr("y",function(d) {return yScale_table(d.rank)-10;})
		.attr("width", function(d) { 
			return 0;
		})
		.attr("height","15");

	svg_table.selectAll(".bar_table").data(season)
		.attr("pointer-events","all")
		.attr("class","bar_table")
		.attr("width",function(d) { 	
			return xScale_table(d.points);
		})
		.attr("height","15")
		.attr("x",xScale_table(0))
		.attr("y",function(d) { 	
			return yScale_table(d.rank)-10;
		})

		.on("mouseenter",function(d,i) { 
			d3.select(".points_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".wins_" + i ).transition().delay(250).attr("width",function() {return xScale_table(d.wins*3) - xScale_table(0);});
			d3.select(".draws_" + i ).transition().delay(300).attr("width",function() {return xScale_table(d.draws) - xScale_table(0);});
			d3.select(".losses_" + i ).transition().delay(350).attr("width",function() {return xScale_table(d.losses*3) - xScale_table(0);});
			d3.select(".wins_text_" + i ).transition().delay(600).attr("visibility","visible");
			d3.select(".draws_text_" + i ).transition().delay(600).attr("visibility","visible");			
			d3.select(".losses_text_" + i ).transition().delay(600).attr("visibility","visible");
			d3.select(".arrow_table_" + i ).transition().delay(600).attr("visibility","visible");
			d3.selectAll(".points_text_table_" + i ).transition().attr("visibility","hidden");
		})

		.on("mouseleave",function(d,i) { 
			d3.select(".points_" + i ).transition().delay(500).attr("width",xScale_table(d.points) - xScale_table(0));
			d3.select(".wins_" + i).transition().attr("width",function() {return 0;});
			d3.select(".draws_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".losses_" + i ).transition().attr("width",function() {return 0;});
			d3.select(".wins_text_" + i ).transition().delay(250).attr("visibility","hidden");
			d3.select(".draws_text_" + i ).transition().delay(250).attr("visibility","hidden");			
			d3.select(".losses_text_" + i ).transition().delay(250).attr("visibility","hidden");	
			d3.select(".arrow_table_" + i ).transition().delay(250).attr("visibility","hidden");					

			d3.selectAll(".points_text_table_" + i ).transition().delay(600).attr("visibility","visible");			
		});

	svg_table.selectAll(".win_text").data(season)
	.attr("class",function(d,i) {return "wins_text_" + i + " win_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(0);})
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.wins + " wins"; 
	});	

	svg_table.selectAll(".draw_text").data(season)
	.attr("class",function(d,i) {return "draws_text_" + i + " draw_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(d.wins*3);})
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.draws + " draws"; 
	});	

	svg_table.selectAll(".loss_text").data(season)
	.attr("class",function(d,i) {return "losses_text_" + i + " loss_text";})
	.attr("pointer-events","none")
	.attr("x",function(d) { return xScale_table(d.wins*3 +d.draws) })
	.attr("y",function(d) {return yScale_table(d.rank);})
	.attr("visibility","hidden")
	.text(function(d) {
		return d.losses + " losses"; 
	});	
}
</script>

</body>
</html>	